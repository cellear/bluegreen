<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 1400" width="800" height="1400">
  <defs>
    <style>
      .layer-title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #333; }
      .func-name { font-family: Arial, sans-serif; font-size: 12px; fill: #333; }
      .func-desc { font-family: Arial, sans-serif; font-size: 10px; fill: #666; }
      .section-bg { fill: #f5f5f5; stroke: #999; stroke-width: 2; }
      .ui-box { fill: #e1f5ff; stroke: #0066cc; stroke-width: 2; }
      .admin-box { fill: #fff4e1; stroke: #ff9900; stroke-width: 2; }
      .batch-box { fill: #e8f5e9; stroke: #4caf50; stroke-width: 3; }
      .module-box { fill: #e1f5ff; stroke: #0066cc; stroke-width: 2; }
      .arrow { stroke: #666; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" style="font-family: Arial; font-size: 20px; font-weight: bold; fill: #333;">
    Complete System Overview
  </text>
  <text x="400" y="50" text-anchor="middle" style="font-family: Arial; font-size: 12px; fill: #666;">
    Blue-Green Deployment Module Architecture
  </text>

  <!-- USER INTERFACE LAYER -->
  <rect class="section-bg" x="50" y="80" width="700" height="100" rx="5"/>
  <text class="layer-title" x="60" y="100">USER INTERFACE LAYER</text>

  <rect class="ui-box" x="100" y="115" width="250" height="50" rx="3"/>
  <text class="func-name" x="225" y="137" text-anchor="middle">admin_form</text>
  <text class="func-desc" x="225" y="152" text-anchor="middle">Main UI</text>

  <rect class="ui-box" x="450" y="115" width="250" height="50" rx="3"/>
  <text class="func-name" x="575" y="137" text-anchor="middle">setup_form</text>
  <text class="func-desc" x="575" y="152" text-anchor="middle">Setup Wizard</text>

  <!-- SUBMIT HANDLERS -->
  <rect class="section-bg" x="50" y="210" width="700" height="120" rx="5"/>
  <text class="layer-title" x="60" y="230">SUBMIT HANDLERS</text>

  <rect class="admin-box" x="80" y="245" width="150" height="40" rx="3"/>
  <text class="func-name" x="155" y="270" text-anchor="middle">backup_submit</text>

  <rect class="admin-box" x="250" y="245" width="150" height="40" rx="3"/>
  <text class="func-name" x="325" y="270" text-anchor="middle">sync_submit</text>

  <rect class="admin-box" x="420" y="245" width="150" height="40" rx="3"/>
  <text class="func-name" x="495" y="270" text-anchor="middle">switch_submit</text>

  <rect class="admin-box" x="590" y="245" width="150" height="40" rx="3"/>
  <text class="func-name" x="665" y="270" text-anchor="middle">setup_form_submit</text>

  <!-- CORE OPERATIONS -->
  <rect class="section-bg" x="50" y="360" width="700" height="100" rx="5"/>
  <text class="layer-title" x="60" y="380">CORE OPERATIONS</text>

  <rect class="admin-box" x="150" y="395" width="200" height="50" rx="3"/>
  <text class="func-name" x="250" y="425" text-anchor="middle">switch_environment</text>

  <rect class="admin-box" x="450" y="395" width="200" height="50" rx="3"/>
  <text class="func-name" x="550" y="425" text-anchor="middle">sync_database</text>

  <!-- BATCH OPERATIONS -->
  <rect class="section-bg" x="50" y="490" width="700" height="180" rx="5"/>
  <text class="layer-title" x="60" y="510">BATCH OPERATIONS</text>

  <rect class="batch-box" x="100" y="525" width="230" height="40" rx="3"/>
  <text class="func-name" x="215" y="550" text-anchor="middle">sync_batch_operation</text>

  <rect class="batch-box" x="470" y="525" width="230" height="40" rx="3"/>
  <text class="func-name" x="585" y="550" text-anchor="middle">setup_duplicate_tables</text>

  <rect class="batch-box" x="100" y="580" width="230" height="40" rx="3"/>
  <text class="func-name" x="215" y="605" text-anchor="middle">setup_create_config_directories</text>

  <rect class="batch-box" x="470" y="580" width="230" height="40" rx="3"/>
  <text class="func-name" x="585" y="605" text-anchor="middle">setup_write_settings</text>

  <rect class="batch-box" x="285" y="635" width="230" height="40" rx="3"/>
  <text class="func-name" x="400" y="660" text-anchor="middle">setup_finalize</text>

  <!-- MODULE FUNCTIONS -->
  <rect class="section-bg" x="50" y="700" width="700" height="650" rx="5"/>
  <text class="layer-title" x="60" y="720">MODULE FUNCTIONS</text>

  <!-- Environment subgroup -->
  <rect x="80" y="740" width="320" height="280" rx="3" fill="none" stroke="#ff9900" stroke-width="1" stroke-dasharray="5,5"/>
  <text x="90" y="760" style="font-family: Arial; font-size: 12px; font-weight: bold; fill: #ff9900;">Environment</text>

  <rect class="module-box" x="100" y="775" width="140" height="35" rx="3"/>
  <text class="func-name" x="170" y="797" text-anchor="middle">get_active_environment</text>

  <rect class="module-box" x="250" y="775" width="130" height="35" rx="3"/>
  <text class="func-name" x="315" y="797" text-anchor="middle">get_environment_info</text>

  <rect class="module-box" x="100" y="820" width="110" height="35" rx="3"/>
  <text class="func-name" x="155" y="842" text-anchor="middle">is_configured</text>

  <rect class="module-box" x="220" y="820" width="160" height="35" rx="3"/>
  <text class="func-name" x="300" y="842" text-anchor="middle">environment_is_installed</text>

  <rect class="module-box" x="100" y="865" width="120" height="35" rx="3"/>
  <text class="func-name" x="160" y="887" text-anchor="middle">get_shared_tables</text>

  <rect class="module-box" x="230" y="865" width="150" height="35" rx="3"/>
  <text class="func-name" x="305" y="887" text-anchor="middle">set_last_sync</text>

  <rect class="module-box" x="100" y="910" width="280" height="35" rx="3"/>
  <text class="func-name" x="240" y="932" text-anchor="middle">get_env_info (calls from above)</text>

  <!-- Configuration subgroup -->
  <rect x="420" y="740" width="310" height="280" rx="3" fill="none" stroke="#4caf50" stroke-width="1" stroke-dasharray="5,5"/>
  <text x="430" y="760" style="font-family: Arial; font-size: 12px; font-weight: bold; fill: #4caf50;">Configuration</text>

  <rect class="module-box" x="440" y="775" width="140" height="35" rx="3"/>
  <text class="func-name" x="510" y="797" text-anchor="middle">detect_config_directory</text>

  <rect class="module-box" x="590" y="775" width="120" height="35" rx="3"/>
  <text class="func-name" x="650" y="797" text-anchor="middle">get_config_directory</text>

  <rect class="module-box" x="440" y="820" width="120" height="35" rx="3"/>
  <text class="func-name" x="500" y="842" text-anchor="middle">sync_config_files</text>

  <rect class="module-box" x="570" y="820" width="140" height="35" rx="3"/>
  <text class="func-name" x="640" y="842" text-anchor="middle">create_alt_config_directory</text>

  <rect class="module-box" x="440" y="865" width="270" height="35" rx="3"/>
  <text class="func-name" x="575" y="887" text-anchor="middle">copy_directory (recursive)</text>

  <!-- State subgroup -->
  <rect x="80" y="1040" width="650" height="90" rx="3" fill="none" stroke="#9c27b0" stroke-width="1" stroke-dasharray="5,5"/>
  <text x="90" y="1060" style="font-family: Arial; font-size: 12px; font-weight: bold; fill: #9c27b0;">State Management</text>

  <rect class="module-box" x="250" y="1075" width="300" height="35" rx="3"/>
  <text class="func-name" x="400" y="1097" text-anchor="middle">set_last_sync (called from batch operations)</text>

  <!-- Arrows - UI to Handlers -->
  <path class="arrow" d="M 225 165 L 325 245"/>
  <path class="arrow" d="M 225 165 L 495 245"/>
  <path class="arrow" d="M 575 165 L 665 245"/>

  <!-- Arrows - Handlers to Operations -->
  <path class="arrow" d="M 495 285 L 250 395"/>
  <path class="arrow" d="M 325 285 L 215 525"/>
  <path class="arrow" d="M 665 285 L 585 525"/>
  <path class="arrow" d="M 665 285 L 585 580"/>
  <path class="arrow" d="M 665 285 L 400 635"/>

  <!-- Arrows - Batch to Core -->
  <path class="arrow" d="M 215 565 L 550 450"/>

  <!-- Arrows - Operations to Module -->
  <path class="arrow" d="M 250 445 L 315 775"/>
  <path class="arrow" d="M 550 445 L 315 775"/>
  <path class="arrow" d="M 550 445 L 160 865"/>

  <!-- Arrows - Batch to Module -->
  <path class="arrow" d="M 585 565 L 160 865"/>
  <path class="arrow" d="M 215 620 L 500 820"/>
  <path class="arrow" d="M 400 675 L 400 1075"/>

  <!-- Arrows - UI to Module -->
  <path class="arrow" d="M 225 165 L 155 820" stroke-dasharray="3,3"/>
  <path class="arrow" d="M 225 165 L 170 775" stroke-dasharray="3,3"/>

  <!-- Legend -->
  <rect x="50" y="1180" width="700" height="180" rx="5" fill="#fafafa" stroke="#ccc" stroke-width="1"/>
  <text x="60" y="1205" style="font-family: Arial; font-size: 14px; font-weight: bold; fill: #333;">Legend</text>

  <rect class="ui-box" x="70" y="1220" width="150" height="30" rx="3"/>
  <text x="145" y="1240" text-anchor="middle" style="font-size: 11px;">UI Layer</text>

  <rect class="admin-box" x="240" y="1220" width="150" height="30" rx="3"/>
  <text x="315" y="1240" text-anchor="middle" style="font-size: 11px;">Admin Functions</text>

  <rect class="batch-box" x="410" y="1220" width="150" height="30" rx="3"/>
  <text x="485" y="1240" text-anchor="middle" style="font-size: 11px;">Batch Operations</text>

  <rect class="module-box" x="580" y="1220" width="150" height="30" rx="3"/>
  <text x="655" y="1240" text-anchor="middle" style="font-size: 11px;">Module Functions</text>

  <line x1="70" y1="1275" x2="150" y2="1275" class="arrow"/>
  <text x="160" y="1280" style="font-size: 11px;">Direct function call</text>

  <line x1="70" y1="1295" x2="150" y2="1295" stroke="#666" stroke-width="2" stroke-dasharray="3,3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="160" y="1300" style="font-size: 11px;">Indirect/conditional call</text>

  <rect x="70" y="1310" width="100" height="30" rx="3" fill="none" stroke="#ff9900" stroke-width="1" stroke-dasharray="5,5"/>
  <text x="180" y="1330" style="font-size: 11px;">Function group boundary</text>
</svg>
